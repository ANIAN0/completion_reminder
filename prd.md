## **DeepSeek 对话实时通知与管理 Chrome 插件 - 产品需求文档 (PRD V1.0)**

### **文档版本**
| 版本 | 修订日期 | 修订人 | 修订说明 |
| :--- | :--- | :--- | :--- |
| 1.0 | 2023-10-27 | PRD 分析师 | 根据首次QA反馈整合定稿，明确所有核心功能与规则。 |

### **1. 产品概述**
#### **1.1 项目背景**
用户在使用 DeepSeek 网页版进行对话时，常需等待AI流式输出。在此期间若切换至其他标签页或应用，用户将无法实时感知回复完成，必须切回页面才能查看结果，导致工作流中断，效率降低。

#### **1.2 产品目标**
开发一款 Chrome 浏览器插件，通过后台监听与独立侧边栏展示，实现：
*   **异步感知**：当 DeepSeek 页面处于后台时，用户仍能通过声音与通知获知回复完成。
*   **对话管理**：在独立侧边栏中集中管理所有 AI 回复，便于追溯、复制与整理。
*   **体验提升**：打造不打断主工作流的、流畅的 AI 异步对话体验。

#### **1.3 核心用户场景**
1.  用户在 DeepSeek 提问后，切换到其他标签页查阅资料或处理工作。
2.  AI回复在后台流式输出完成，插件立即播放提示音并发送系统通知。
3.  用户听到提醒后，点击插件图标打开侧边栏，无需切回 DeepSeek 页面即可在卡片中阅读完整回复。
4.  用户可将卡片内容一键复制使用，或对回复进行本地编辑修正。

### **2. 需求范围**
#### **2.1 本版本包含 (In-Scope)**
1.  Chrome 插件基础框架（Manifest V3）。
2.  插件图标及动态下拉菜单。
3.  浏览器侧边栏（Side Panel）UI 与功能。
4.  对 DeepSeek 官方网页流式输出的后台监听能力（优先尝试拦截网络流，备选监听DOM）。
5.  对话卡片的自动创建、流式更新、状态管理与本地操作（复制、编辑、删除）。
6.  后台对话完成的即时提醒（提示音 + 系统通知）。
7.  提示音的自定义上传与配置功能。

#### **2.2 本版本不包含 (Out-of-Scope)**
1.  用户身份认证或与 DeepSeek 账户同步。
2.  将编辑后的卡片内容同步回 DeepSeek 网页。
3.  云端存储、同步或分享功能。
4.  支持除 DeepSeek 官方网页外的其他 AI 聊天站点。
5.  插件内的对话历史搜索功能。

### **3. 功能性需求详述**
#### **3.1 插件图标与下拉菜单**
*   **UI**：遵循 Chrome 扩展图标规范，建议使用简约 Logo。
*   **交互**：
    1.  点击图标，弹出下拉菜单。
    2.  **菜单项**：
        *   **打开侧边栏**：点击后打开/聚焦浏览器的侧边栏面板。
            *   *动态状态*：当侧边栏已处于打开状态时，此按钮变为**禁用（灰色不可点击）**。
        *   **提示音配置**：点击后弹出配置浮层（见3.4节）。
        *   **关于**：显示插件名称与版本信息。
    3.  点击菜单外部或选择项后，菜单关闭。

#### **3.2 侧边栏与卡片管理 (核心功能)**
*   **打开方式**：点击插件菜单的“打开侧边栏”，或通过浏览器侧边栏入口打开。
*   **UI 风格**：整体采用 **shadcn/ui** 设计风格，保持现代、简洁。
*   **监听与同步逻辑**：
    1.  **监听触发**：当检测到浏览器内存在 DeepSeek（`chat.deepseek.com`）标签页时，插件自动开始工作。
    2.  **对话识别**：以用户在 DeepSeek 页面**每次“发送”动作为一个新对话的开始**。插件为该次对话生成唯一 ID。
    3.  **卡片创建**：当检测到新对话的流式响应开始时，侧边栏**自动创建一张新卡片**，并置于列表顶部。
    4.  **流式更新**：在 DeepSeek 页面（即使处于后台）流式输出过程中，插件实时捕获文本流，并在对应卡片内**同步、增量式地更新显示内容**。
    5.  **状态判定**：
        *   **进行中**：卡片创建后，正在接收流式数据。**视觉标识**：卡片顶部状态条为蓝色。
        *   **已完成**：流式输出停止，且持续 **2秒** 无新数据。**视觉标识**：卡片顶部状态条变为绿色。
*   **卡片交互**：
    *   **布局**：卡片列表按**创建时间降序**排列。卡片宽度自适应侧边栏，高度随内容自适应。
    *   **复制**：每个已完成卡片有“复制”按钮。点击后，将该卡片内的全部文本内容写入系统剪贴板。
    *   **编辑**：每个已完成卡片有“编辑”按钮。
        *   点击后，卡片内容区域变为一个可编辑的文本框，并聚焦。
        *   用户修改后，点击“保存”确认修改，或点击“取消”放弃。
        *   修改后的内容**仅保存在插件本地存储中**，不会同步回 DeepSeek。
        *   编辑操作**不改变卡片状态**，也不保存历史版本。
    *   **删除**：每个卡片有“删除”按钮。点击后弹出二次确认（“确认删除此条记录？”），确认后从侧边栏和本地存储中永久移除该卡片。

#### **3.3 提醒机制**
*   **触发条件**：同时满足以下两点：
    1.  对话所在的 DeepSeek 源标签页**非当前激活页**（即处于浏览器后台）。
    2.  任意一个卡片的状态从 **“进行中”** 变为 **“已完成”**。
*   **触发动作（同时进行）**：
    1.  **播放提示音**：立即播放用户当前设定的提示音（默认或自定义）。
    2.  **发送系统通知**：在桌面右下角（或系统通知区域）弹出通知。
        *   **标题**：`DeepSeek 回复已完成`
        *   **内容**：显示回复的前50个字符（或处理为纯文本的预览）。
        *   **点击行为**：点击该通知，应**激活对应的 DeepSeek 源标签页**，并**聚焦浏览器**。
*   **多条提醒策略**：**每条**对话完成均独立触发一次完整的提醒（音效+通知），不做去重或合并。

#### **3.4 提示音配置**
*   **入口**：通过插件图标下拉菜单的“提示音配置”进入。
*   **配置浮层内容**：
    1.  **当前提示音预览**：显示当前使用中的提示音名称，并提供“试听”按钮。
    2.  **上传新提示音**：
        *   文件上传按钮，支持 `.mp3` 格式。
        *   用户选择文件后，前端进行校验：
            *   若文件大小 **> 500KB**，立即报错“文件大小不得超过500KB”，阻止上传。
            *   若格式不符，报错“请上传 MP3 格式文件”。
        *   校验通过后，自动将文件转换为 Base64 或 ArrayBuffer 格式，保存至 `chrome.storage.local`。
    3.  **恢复默认**：提供按钮，点击后清除用户自定义的提示音，恢复使用内置默认音。
*   **内置默认音**：插件必须内置一个高质量的默认提示音，并打包在扩展中，确保用户始终有音可用。

### **4. 非功能性需求**
1.  **性能**：
    *   插件对 DeepSeek 网页本身的性能影响应微乎其微（CPU/内存占用率增加 < 2%）。
    *   侧边栏内卡片列表滑动应流畅，即使有大量历史记录。
2.  **数据持久化与隐私**：
    *   所有卡片数据、配置均使用 `chrome.storage.local` API 存储在用户本地浏览器。
    *   在隐私政策或插件描述中明确声明：**本插件不会收集、上传任何用户对话数据至任何远程服务器。**
3.  **兼容性**：
    *   浏览器：支持最新稳定版的 Chrome 及基于 Chromium 的 Edge。
    *   目标网站：支持 `chat.deepseek.com`。
4.  **可靠性**：
    *   插件应能耐受网络抖动，避免因短暂断连导致卡片状态错误。
    *   若 DeepSeek 页面被刷新或关闭，其对应的“进行中”卡片应标记为“已中断”或保留最后状态。

### **5. 后续步骤与建议**
1.  **技术方案评审**：召集前端开发工程师，基于本 PRD 重点评审 **3.2 节的监听与同步逻辑**，确定技术实现路径（网络请求拦截 vs. DOM 监听）及具体技术栈。
2.  **UI/UX 设计**：根据 **shadcn/ui** 风格，设计插件图标、下拉菜单、侧边栏及卡片的详细高保真原型，特别是“进行中/已完成”的状态视觉设计。
3.  **开发排期**：建议将开发分为两个核心阶段：
    *   **Phase 1（核心 MVP）**：侧边栏、基础监听、卡片流式更新、本地存储。
    *   **Phase 2（体验增强）**：提醒功能（音效+通知）、提示音配置、卡片编辑等交互功能。
4.  **测试计划**：需重点测试：
    *   多标签页场景下的监听准确性。
    *   后台提醒的触发时机和准确性。
    *   本地数据在各种情况（浏览器重启、插件更新）下的持久化。

---

**本 PRD V1.0 已整合所有已确认的需求，可作为项目启动的基准文档。** 任何后续的功能增减或规则变更，都应在此文档基础上进行更新并通知所有项目干系人。